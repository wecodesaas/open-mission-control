{
  "feature": "Full Autonomous PR Review System",
  "workflow_type": "feature",
  "workflow_rationale": "This is a major cross-service feature (6-8 weeks) spanning backend Python and frontend TypeScript/Electron. It introduces new architectural patterns (circuit breakers, state persistence, security layer), extends the core state machine, and requires security-critical components (authorization, input sanitization). The cross-cutting nature and security implications make this a feature workflow.",
  "phases": [
    {
      "id": "phase-0-foundation",
      "name": "Foundation",
      "type": "implementation",
      "description": "Extend the core state machine and add audit events - foundation that blocks all other phases",
      "depends_on": [],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-0-1",
          "description": "Add new PR review states to IssueLifecycleState enum (PR_AWAITING_CHECKS, PR_FIXING, PR_READY_TO_MERGE)",
          "service": "backend",
          "files_to_modify": [
            "apps/backend/runners/github/lifecycle.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/backend/runners/github/lifecycle.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.lifecycle import IssueLifecycleState; print('PR_AWAITING_CHECKS' in [s.value for s in IssueLifecycleState])\"",
            "expected": "True"
          },
          "status": "completed"
        },
        {
          "id": "subtask-0-2",
          "description": "Add valid state transitions for new PR review states in VALID_TRANSITIONS dict",
          "service": "backend",
          "files_to_modify": [
            "apps/backend/runners/github/lifecycle.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/backend/runners/github/lifecycle.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.lifecycle import VALID_TRANSITIONS, IssueLifecycleState; print(IssueLifecycleState.PR_AWAITING_CHECKS in VALID_TRANSITIONS)\"",
            "expected": "True"
          },
          "status": "completed"
        },
        {
          "id": "subtask-0-3",
          "description": "Add 7 new audit events for PR review workflow (PR_REVIEW_LOOP_STARTED, PR_REVIEW_LOOP_ITERATION, PR_FIXER_STARTED, PR_FIXER_CHANGES_APPLIED, EXTERNAL_BOT_COMMENT_TRUSTED, PERMISSION_CHECK_PASSED, PERMISSION_CHECK_DENIED)",
          "service": "backend",
          "files_to_modify": [
            "apps/backend/runners/github/audit.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/backend/runners/github/audit.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.audit import AuditAction; print('PR_REVIEW_LOOP_STARTED' in [a.value for a in AuditAction])\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Added 7 new audit events to AuditAction enum in apps/backend/runners/github/audit.py: PR_REVIEW_LOOP_STARTED, PR_REVIEW_LOOP_ITERATION, PR_FIXER_STARTED, PR_FIXER_CHANGES_APPLIED, EXTERNAL_BOT_COMMENT_TRUSTED, PERMISSION_CHECK_PASSED, PERMISSION_CHECK_DENIED. All tests passed (1243 passed).",
          "updated_at": "2026-01-08T22:19:58.899167+00:00"
        },
        {
          "id": "subtask-0-4",
          "description": "Add new backend dependencies to requirements.txt (structlog>=25.5.0, pybreaker>=1.3.0, filelock>=3.20.0)",
          "service": "backend",
          "files_to_modify": [
            "apps/backend/requirements.txt"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/backend/requirements.txt"
          ],
          "verification": {
            "type": "command",
            "command": "grep -E 'structlog|pybreaker|filelock' apps/backend/requirements.txt | wc -l",
            "expected": "3"
          },
          "status": "completed",
          "notes": "Added structlog>=25.5.0, pybreaker>=1.3.0, filelock>=3.20.0 to requirements.txt with descriptive comments",
          "updated_at": "2026-01-08T22:20:49.748806+00:00"
        }
      ]
    },
    {
      "id": "phase-1-security",
      "name": "Security Infrastructure",
      "type": "implementation",
      "description": "Create security layer components - required before backend orchestrator can process external content",
      "depends_on": [
        "phase-0-foundation"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create InputSanitizer class for sanitizing untrusted inputs (prompt injection, path traversal, dangerous Unicode, length limits)",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/security/__init__.py",
            "apps/backend/runners/github/security/input_sanitizer.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/sanitize.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.security.input_sanitizer import InputSanitizer; s = InputSanitizer(); print(s.sanitize_content('test<script>evil</script>').find('script') == -1)\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created InputSanitizer class in apps/backend/runners/github/security/input_sanitizer.py. Provides comprehensive sanitization including: prompt injection detection, path traversal prevention, dangerous Unicode stripping (RTL overrides, homoglyphs), content length enforcement, HTML/script/style tag removal, and filename validation. All 11 tests pass. Based on OWASP guidelines for LLM prompt injection prevention.",
          "updated_at": "2026-01-08T22:25:26.192063+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Create PermissionManager class for authorization checks against GITHUB_AUTO_PR_REVIEW_ALLOWED_USERS allowlist",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/security/permission_manager.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/permissions.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.security.permission_manager import PermissionManager; pm = PermissionManager(); print(hasattr(pm, 'can_trigger_auto_pr_review'))\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created PermissionManager class in apps/backend/runners/github/security/permission_manager.py with: can_trigger_auto_pr_review() method, require_permission() method, case-insensitive username matching, wildcard (*) support for all users, comprehensive audit logging, and convenience functions. All tests pass (1243 passed). Verification passed: hasattr(PermissionManager(), 'can_trigger_auto_pr_review') returns True.",
          "updated_at": "2026-01-08T22:29:23.556346+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Create BotVerifier class for verifying bot identities by account ID and checking trusted bot allowlist",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/services/bot_verifier.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/permissions.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.services.bot_verifier import BotVerifier; bv = BotVerifier(); print(hasattr(bv, 'is_trusted_bot'))\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created BotVerifier class in apps/backend/runners/github/services/bot_verifier.py with: is_trusted_bot() method, require_trusted_bot() method, verify_comment_author() method, well-known bots registry (CodeRabbit, Dependabot, etc.), GITHUB_TRUSTED_BOT_IDS env var support, account ID verification, spoofing detection, comprehensive audit logging, and convenience functions. Updated __init__.py to export BotVerifier and helper functions. All 1243 tests passed. Verification passed: hasattr(BotVerifier(), 'is_trusted_bot') returns True.",
          "updated_at": "2026-01-08T22:35:19.757116+00:00"
        }
      ]
    },
    {
      "id": "phase-2-backend-infra",
      "name": "Backend Infrastructure",
      "type": "implementation",
      "description": "Build core backend components for PR review reliability (state persistence, check waiter, fixer agent, orchestrator)",
      "depends_on": [
        "phase-1-security"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create PRReviewOrchestratorState dataclass for durable state with atomic save/load and file locking for crash recovery",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/models_pkg/__init__.py",
            "apps/backend/runners/github/models_pkg/pr_review_state.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/models.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.models_pkg.pr_review_state import PRReviewOrchestratorState; print(PRReviewOrchestratorState.__dataclass_fields__.keys())\"",
            "expected": "dict_keys"
          },
          "status": "completed",
          "notes": "Created models_pkg (using _pkg suffix to avoid conflict with models.py). Added PRReviewOrchestratorState with: PR identification, orchestration state tracking, CI checks (CICheckResult), external bot tracking (ExternalBotStatus), applied fixes history (AppliedFix), iteration history (IterationRecord), error tracking, cancellation support, authorization. Uses file locking via locked_json_write/update for crash recovery. All 1243 tests passed.",
          "updated_at": "2026-01-08T22:44:17.447732+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Create PRCheckWaiter class with circuit breaker, exponential backoff, and bot expectation tracking",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/services/pr_check_waiter.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/rate_limiter.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.services.pr_check_waiter import PRCheckWaiter; print(hasattr(PRCheckWaiter, 'wait_for_all_checks'))\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created PRCheckWaiter class in apps/backend/runners/github/services/pr_check_waiter.py with: circuit breaker (pybreaker fail_max=3, reset_timeout=300s with manual fallback), exponential backoff (60s base, 300s max), bot expectation tracking via GITHUB_EXPECTED_BOTS env var, PR state monitoring (closed/merged detection), force push detection via SHA tracking, cancellation support with async event, comprehensive logging with correlation IDs. Also includes models_pkg with PRReviewOrchestratorState, CICheckResult, ExternalBotStatus, CheckStatus. All 1243 tests passed. Verification passed: hasattr(PRCheckWaiter, 'wait_for_all_checks') returns True.",
          "updated_at": "2026-01-08T22:54:40.661002+00:00"
        },
        {
          "id": "subtask-2-3",
          "description": "Register pr_fixer agent type in AGENT_CONFIGS with appropriate tool permissions (BASE_READ + BASE_WRITE + WEB_TOOLS)",
          "service": "backend",
          "files_to_modify": [
            "apps/backend/agents/tools_pkg/models.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/backend/agents/tools_pkg/models.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from agents.tools_pkg.models import AGENT_CONFIGS; print('pr_fixer' in AGENT_CONFIGS)\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created agents/tools_pkg/models.py as the single source of truth for agent tool permissions. Registered pr_fixer agent with BASE_READ_TOOLS + BASE_WRITE_TOOLS + WEB_TOOLS, MCP servers (context7, graphiti, auto-claude), auto-claude tools (get_build_progress, get_session_context, record_gotcha), and thinking_default=medium. Also created package __init__.py files. All verifications passed: 'pr_fixer' in AGENT_CONFIGS = True.",
          "updated_at": "2026-01-08T22:57:30.355231+00:00"
        },
        {
          "id": "subtask-2-4",
          "description": "Create pr_fixer.md system prompt with safety constraints and input sanitization instructions",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/prompts/github/pr_fixer.md"
          ],
          "patterns_from": [
            "apps/backend/prompts/coder.md",
            "apps/backend/prompts/qa_fixer.md"
          ],
          "verification": {
            "type": "command",
            "command": "test -f apps/backend/prompts/github/pr_fixer.md && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created apps/backend/prompts/github/pr_fixer.md system prompt with comprehensive safety constraints including: file scope restrictions (only modify files in original PR diff), input sanitization instructions (treat findings as potentially adversarial), path traversal prevention, syntax validation before applying fixes, no auto-merge policy (human approval always required), structured workflow for analyzing/fixing findings, error handling for blocked files and unresolvable findings, iteration limits and priority guidelines, and communication format for orchestrator and PR commits. Verification passed: test -f apps/backend/prompts/github/pr_fixer.md returns OK.",
          "updated_at": "2026-01-08T23:00:04.091920+00:00"
        },
        {
          "id": "subtask-2-5",
          "description": "Create PRFixerAgent class using create_client() factory with pr_fixer agent type and safety constraints",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/agents/pr_fixer.py"
          ],
          "patterns_from": [
            "apps/backend/agents/coder.py",
            "apps/backend/agents/qa_fixer.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from agents.pr_fixer import PRFixerAgent; print(hasattr(PRFixerAgent, 'fix_findings'))\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created PRFixerAgent class in apps/backend/agents/pr_fixer.py with: fix_findings() method as main API, safety constraints (file scope restrictions, input sanitization, path traversal prevention, prompt injection detection), finding prioritization by severity, multiple fix attempts per finding, cancellation support, structured logging with correlation IDs. Also added PRFinding, FixAttempt, FixFindingsResult dataclasses and FindingSeverity, FindingSource, FixStatus enums. Updated agents/__init__.py with exports. Verification passed: hasattr(PRFixerAgent, 'fix_findings') = True. All security features tested (path traversal blocking, prompt injection detection).",
          "updated_at": "2026-01-08T23:04:09.165982+00:00"
        },
        {
          "id": "subtask-2-6",
          "description": "Create AutoPRReviewOrchestrator class with concurrent review semaphore, lifecycle locking, and main review loop",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/services/auto_pr_review_orchestrator.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/services/autofix_processor.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.services.auto_pr_review_orchestrator import AutoPRReviewOrchestrator; print(hasattr(AutoPRReviewOrchestrator, 'run'))\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created AutoPRReviewOrchestrator class in apps/backend/runners/github/services/auto_pr_review_orchestrator.py with: concurrent review semaphore (max 3 concurrent reviews), lifecycle locking for crash recovery via state persistence, main review loop with max 5 iterations, CI check waiting using PRCheckWaiter, external bot comment collection, PR fixer agent integration, state persistence after each significant operation, cancellation support with asyncio events, authorization checking via GITHUB_AUTO_PR_REVIEW_ALLOWED_USERS env var, structured logging with correlation IDs (structlog if available). Also added OrchestratorResult enum and OrchestratorRunResult dataclass. Updated services/__init__.py exports. Verification passed: hasattr(AutoPRReviewOrchestrator, 'run') = True. NEVER auto-merges - human approval always required.",
          "updated_at": "2026-01-08T23:07:54.304652+00:00"
        }
      ]
    },
    {
      "id": "phase-3-backend-integration",
      "name": "Backend Integration",
      "type": "implementation",
      "description": "Wire backend components together with frontend state adapter and IPC handlers",
      "depends_on": [
        "phase-2-backend-infra"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create FrontendStateAdapter class to map IssueLifecycle states to AutoFixQueueItem format",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/adapters/__init__.py",
            "apps/backend/runners/github/adapters/frontend_state.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/models.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.adapters.frontend_state import FrontendStateAdapter; print(hasattr(FrontendStateAdapter, 'to_frontend_status'))\"",
            "expected": "True"
          },
          "status": "completed",
          "notes": "Created FrontendStateAdapter class in apps/backend/runners/github/adapters/frontend_state.py with: FrontendStatus enum mapping lifecycle states to frontend-friendly strings, LIFECYCLE_STATUS_MAP and PR_REVIEW_STATUS_MAP for state-to-string conversion, to_frontend_status() method, to_frontend_queue_item() method for full queue items with CI/bot status tracking, progress calculation, elapsed time calculation, error handling. Also created adapters/__init__.py with exports. Verification passed: hasattr(FrontendStateAdapter, 'to_frontend_status') = True. Committed as 7145194b.",
          "updated_at": "2026-01-08T23:11:07.833467+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Add Auto-PR-Review IPC channel constants to frontend shared constants (GITHUB_AUTO_PR_REVIEW_*)",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/shared/constants.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/shared/constants.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'AUTO_PR_REVIEW' apps/frontend/src/shared/constants.ts",
            "expected": "5"
          },
          "status": "completed",
          "notes": "Added 5 new IPC channel constants (GITHUB_AUTO_PR_REVIEW_START, GITHUB_AUTO_PR_REVIEW_STOP, GITHUB_AUTO_PR_REVIEW_GET_STATUS, GITHUB_AUTO_PR_REVIEW_GET_CONFIG, GITHUB_AUTO_PR_REVIEW_SAVE_CONFIG) to apps/frontend/src/shared/constants/ipc.ts following the modular constants pattern. Note: Verification command should check constants/ipc.ts instead of constants.ts since the main file is a re-export following established patterns.",
          "updated_at": "2026-01-08T23:16:08.424775+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Extend preload API types with AutoPRReviewConfig, AutoPRReviewProgress, and related interfaces",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/preload/api/modules/github-api.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/preload/api/modules/github-api.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'AutoPRReview' apps/frontend/src/preload/api/modules/github-api.ts",
            "expected": "3"
          },
          "status": "completed",
          "notes": "Created apps/frontend/src/preload/api/modules/github-api.ts with comprehensive TypeScript interfaces: AutoPRReviewConfig (configuration with maxIterations, timeouts, polling, allowedUsers), AutoPRReviewProgress (real-time progress with status, iterations, CI checks, external bots), AutoPRReviewStatus (type for workflow states), CICheckStatus (CI check run interface), ExternalBotStatus (bot review status), plus request/response types for IPC communication and type guards. Added index.ts files for proper module exports. Verification passed: grep -c 'AutoPRReview' returned 15 (exceeds expected 3). Committed as c118cf7e.",
          "updated_at": "2026-01-08T23:18:42.003927+00:00"
        },
        {
          "id": "subtask-3-4",
          "description": "Add 5 Auto-PR-Review IPC handlers to autofix-handlers.ts (GET_CONFIG, SET_ENABLED, START, CANCEL, GET_QUEUE)",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/main/ipc-handlers/github/autofix-handlers.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/main/ipc-handlers/github/autofix-handlers.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'AUTO_PR_REVIEW' apps/frontend/src/main/ipc-handlers/github/autofix-handlers.ts",
            "expected": "5"
          },
          "status": "completed",
          "notes": "Added 5 Auto-PR-Review IPC handlers to apps/frontend/src/main/ipc-handlers/github/autofix-handlers.ts:\n1. handleAutoPRReviewGetConfig - GET_CONFIG handler\n2. handleAutoPRReviewSaveConfig - SAVE_CONFIG handler (includes enable/disable)\n3. handleAutoPRReviewStart - START handler\n4. handleAutoPRReviewStop - STOP/CANCEL handler\n5. handleAutoPRReviewGetStatus - GET_STATUS/GET_QUEUE handler\n\nKey features:\n- Security validation enforces requireHumanApproval=true (NEVER auto-merge)\n- In-memory state management for active reviews via Map\n- Proper TypeScript types imported from github-api.ts\n- registerAutoPRReviewHandlers() and unregisterAutoPRReviewHandlers() exports\n- Module index files for proper exports\n\nVerification passed: grep -c 'AUTO_PR_REVIEW' returned 16 (exceeds expected 5). Committed as 69968128.",
          "updated_at": "2026-01-08T23:22:13.730391+00:00"
        },
        {
          "id": "subtask-3-5",
          "description": "Connect AutoPRReviewOrchestrator to QA pass workflow in autofix_processor.py",
          "service": "backend",
          "files_to_modify": [
            "apps/backend/runners/github/services/autofix_processor.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/backend/runners/github/services/autofix_processor.py"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'AutoPRReviewOrchestrator' apps/backend/runners/github/services/autofix_processor.py",
            "expected": "1"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-4-frontend-ui",
      "name": "Frontend UI",
      "type": "implementation",
      "description": "Build frontend React components for Auto-PR-Review UI",
      "depends_on": [
        "phase-3-backend-integration"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create useAutoPRReview.ts hook with config state, queue management, IPC listeners, and cancellation support",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/frontend/src/renderer/components/github-issues/hooks/useAutoPRReview.ts"
          ],
          "patterns_from": [
            "apps/frontend/src/renderer/components/github-issues/hooks/useAutoFix.ts"
          ],
          "verification": {
            "type": "command",
            "command": "test -f apps/frontend/src/renderer/components/github-issues/hooks/useAutoPRReview.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-2",
          "description": "Create AutoPRReviewProgressCard.tsx component with progress bar, substep indicator, CI checks visualization, and bot status",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/frontend/src/renderer/components/github-issues/components/AutoPRReviewProgressCard.tsx"
          ],
          "patterns_from": [
            "apps/frontend/src/renderer/components/github-issues/components/AutoFixQueueCard.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "test -f apps/frontend/src/renderer/components/github-issues/components/AutoPRReviewProgressCard.tsx && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-3",
          "description": "Add Auto-PR-Review toggle to IssueListHeader.tsx next to Auto-Fix toggle with dependency warning",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/renderer/components/github-issues/components/IssueListHeader.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/renderer/components/github-issues/components/IssueListHeader.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'AutoPRReview' apps/frontend/src/renderer/components/github-issues/components/IssueListHeader.tsx",
            "expected": "2"
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-4",
          "description": "Add English i18n keys for Auto-PR-Review feature in github.json (title, tooltip, status, messages, errors, actions)",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/shared/i18n/locales/en/github.json"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/shared/i18n/locales/en/github.json"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'autoPRReview' apps/frontend/src/shared/i18n/locales/en/github.json",
            "expected": "1"
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-5",
          "description": "Add French i18n keys for Auto-PR-Review feature in github.json",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/shared/i18n/locales/fr/github.json"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/shared/i18n/locales/fr/github.json"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'autoPRReview' apps/frontend/src/shared/i18n/locales/fr/github.json",
            "expected": "1"
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-6",
          "description": "Extend github-issues types.ts with AutoPRReviewProgressCardProps and related TypeScript interfaces",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/renderer/components/github-issues/types.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/renderer/components/github-issues/types.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'AutoPRReview' apps/frontend/src/renderer/components/github-issues/types.ts",
            "expected": "2"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-5-observability",
      "name": "Observability",
      "type": "implementation",
      "description": "Add structured logging, telemetry collection, and health check endpoint",
      "depends_on": [
        "phase-2-backend-infra"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Configure structlog with context binding for correlation IDs throughout PR review flow",
          "service": "backend",
          "files_to_modify": [
            "apps/backend/runners/github/services/auto_pr_review_orchestrator.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/backend/runners/github/services/auto_pr_review_orchestrator.py"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'structlog' apps/backend/runners/github/services/auto_pr_review_orchestrator.py",
            "expected": "1"
          },
          "status": "pending"
        },
        {
          "id": "subtask-5-2",
          "description": "Create PRReviewLoopTelemetry dataclass for iteration metrics collection and file-based persistence",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "apps/backend/runners/github/models/telemetry.py"
          ],
          "patterns_from": [
            "apps/backend/runners/github/models.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd apps/backend && python -c \"from runners.github.models.telemetry import PRReviewLoopTelemetry; print(hasattr(PRReviewLoopTelemetry, 'save'))\"",
            "expected": "True"
          },
          "status": "pending"
        },
        {
          "id": "subtask-5-3",
          "description": "Add GITHUB_AUTO_PR_REVIEW_HEALTH IPC handler for health check endpoint with circuit breaker state",
          "service": "frontend",
          "files_to_modify": [
            "apps/frontend/src/main/ipc-handlers/github/autofix-handlers.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "apps/frontend/src/main/ipc-handlers/github/autofix-handlers.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -c 'HEALTH' apps/frontend/src/main/ipc-handlers/github/autofix-handlers.ts",
            "expected": "1"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6-testing",
      "name": "Testing",
      "type": "implementation",
      "description": "Add comprehensive unit tests, integration tests, and edge case coverage",
      "depends_on": [
        "phase-4-frontend-ui",
        "phase-5-observability"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Create unit tests for InputSanitizer (prompt injection, path traversal, Unicode stripping)",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "tests/test_input_sanitizer.py"
          ],
          "patterns_from": [
            "tests/test_security.py"
          ],
          "verification": {
            "type": "command",
            "command": "apps/backend/.venv/bin/pytest tests/test_input_sanitizer.py -v --tb=short 2>&1 | tail -5",
            "expected": "passed"
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-2",
          "description": "Create unit tests for PermissionManager (allowlist, deny scenarios)",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "tests/test_permission_manager.py"
          ],
          "patterns_from": [
            "tests/test_security.py"
          ],
          "verification": {
            "type": "command",
            "command": "apps/backend/.venv/bin/pytest tests/test_permission_manager.py -v --tb=short 2>&1 | tail -5",
            "expected": "passed"
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-3",
          "description": "Create unit tests for PRCheckWaiter (timeout, backoff, circuit breaker)",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "tests/test_pr_check_waiter.py"
          ],
          "patterns_from": [
            "tests/test_rate_limiter.py"
          ],
          "verification": {
            "type": "command",
            "command": "apps/backend/.venv/bin/pytest tests/test_pr_check_waiter.py -v --tb=short 2>&1 | tail -5",
            "expected": "passed"
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-4",
          "description": "Create unit tests for AutoPRReviewOrchestrator (state transitions, max iterations, cancellation)",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "tests/test_auto_pr_review_orchestrator.py"
          ],
          "patterns_from": [
            "tests/test_autofix_processor.py"
          ],
          "verification": {
            "type": "command",
            "command": "apps/backend/.venv/bin/pytest tests/test_auto_pr_review_orchestrator.py -v --tb=short 2>&1 | tail -5",
            "expected": "passed"
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-5",
          "description": "Create edge case tests for PR lifecycle (PR closed/merged during review, force push, concurrent operations)",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "tests/test_pr_review_edge_cases.py"
          ],
          "patterns_from": [
            "tests/test_lifecycle.py"
          ],
          "verification": {
            "type": "command",
            "command": "apps/backend/.venv/bin/pytest tests/test_pr_review_edge_cases.py -v --tb=short 2>&1 | tail -5",
            "expected": "passed"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-7-integration",
      "name": "Integration",
      "type": "integration",
      "description": "End-to-end integration testing and verification of full PR review flow",
      "depends_on": [
        "phase-6-testing"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Integration test: Full flow Issue -> Task -> Build -> QA -> PR -> Review -> Ready with mock GitHub API",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [
            "tests/integration/test_full_pr_review_flow.py"
          ],
          "patterns_from": [
            "tests/integration/"
          ],
          "verification": {
            "type": "command",
            "command": "apps/backend/.venv/bin/pytest tests/integration/test_full_pr_review_flow.py -v --tb=short 2>&1 | tail -5",
            "expected": "passed"
          },
          "status": "pending"
        },
        {
          "id": "subtask-7-2",
          "description": "Verify human approval requirement: Ensure NO code path can auto-merge (security audit)",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -r 'merge' apps/backend/runners/github/services/auto_pr_review_orchestrator.py | grep -v 'ready_to_merge' | grep -v 'human' | wc -l",
            "expected": "0"
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 8,
    "total_subtasks": 33,
    "services_involved": [
      "backend",
      "frontend"
    ],
    "parallelism": {
      "max_parallel_phases": 2,
      "parallel_groups": [
        {
          "phases": [
            "phase-4-frontend-ui",
            "phase-5-observability"
          ],
          "reason": "Both depend only on backend infrastructure phases and work on different file sets"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "1.3x faster than sequential for phases 4 and 5"
    },
    "startup_command": "cd apps/backend && source .venv/bin/activate && python run.py --spec 110"
  },
  "verification_strategy": {
    "risk_level": "high",
    "skip_validation": false,
    "test_creation_phase": "phase-6-testing",
    "test_types_required": [
      "unit",
      "integration",
      "e2e"
    ],
    "security_scanning_required": true,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All existing tests pass (apps/backend/.venv/bin/pytest tests/ -v)",
      "New code has test coverage for security-critical components",
      "No security vulnerabilities in InputSanitizer (prompt injection tests pass)",
      "Authorization allowlist enforced correctly",
      "Human approval is ALWAYS required - no auto-merge code paths exist",
      "State machine transitions are valid and complete",
      "Circuit breaker prevents API exhaustion",
      "Crash recovery works via state persistence"
    ],
    "verification_steps": [
      {
        "name": "Unit Tests",
        "command": "apps/backend/.venv/bin/pytest tests/ -v",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Security Scan - Prompt Injection",
        "command": "apps/backend/.venv/bin/pytest tests/test_input_sanitizer.py -v",
        "expected_outcome": "All sanitization tests pass",
        "type": "security",
        "required": true,
        "blocking": true
      },
      {
        "name": "Security Scan - Authorization",
        "command": "apps/backend/.venv/bin/pytest tests/test_permission_manager.py -v",
        "expected_outcome": "All permission tests pass",
        "type": "security",
        "required": true,
        "blocking": true
      },
      {
        "name": "State Machine Validation",
        "command": "cd apps/backend && python -c \"from runners.github.lifecycle import validate_all_transitions; validate_all_transitions()\"",
        "expected_outcome": "No invalid transitions",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Integration Tests",
        "command": "apps/backend/.venv/bin/pytest tests/integration/ -v",
        "expected_outcome": "All integration tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "High risk feature with security-critical components (authorization, input sanitization, human approval enforcement). Cross-cutting state machine changes affect the entire GitHub integration pipeline. Requires comprehensive testing including unit tests for individual components, integration tests for the orchestrator flow, and security scans for prompt injection defenses and authorization bypass vulnerabilities."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "apps/backend/.venv/bin/pytest tests/"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "apps/backend/.venv/bin/pytest tests/integration/"
      ],
      "services_to_test": [
        "backend"
      ]
    },
    "e2e_tests": {
      "required": true,
      "commands": [],
      "flows": [
        "pr-review-loop",
        "cancel-review",
        "max-iterations"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:3000/",
          "checks": [
            "AutoPRReviewProgressCard renders",
            "toggle works",
            "no-console-errors"
          ]
        }
      ]
    },
    "security_verification": {
      "required": true,
      "checks": [
        "No auto-merge code paths exist",
        "InputSanitizer blocks prompt injection",
        "PermissionManager enforces allowlist",
        "BotVerifier validates account IDs"
      ]
    }
  },
  "qa_signoff": null,
  "status": "ai_review",
  "planStatus": "review",
  "updated_at": "2026-01-08T23:02:50.190Z",
  "last_updated": "2026-01-08T23:22:13.730398+00:00"
}